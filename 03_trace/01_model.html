
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Advanced trace &#8212; sim-tools docs</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '03_trace/01_model';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Automating the selection of the number of replications" href="../04_replications/01_automated_reps.html" />
    <link rel="prev" title="A simple trace" href="01_simple_trace.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../00_front_page.html">
  
  
  
  
  
  
    <p class="title logo__title">sim-tools docs</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../00_front_page.html">
                    Vision for sim-tools
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Sampling</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../01_sampling/01_distributions_examples.html">Sampling using <code class="docutils literal notranslate"><span class="pre">sim_tools</span></code> classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01_sampling/02_time_dependent_examples.html">Time dependent arrivals via thinning</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Debugging</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_simple_trace.html">A simple trace</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Advanced trace</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Output Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../04_replications/01_automated_reps.html">Automating the selection of the number of replications</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Optimisation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../02_ovs/03_sw21_tutorial.html">An Introduction to Optimisation via Simulation.</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Release History</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../03_CHANGES.html">Change log</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/TomMonks/sim-tools/main?urlpath=lab/tree/03_trace/01_model.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/TomMonks/sim-tools/blob/main/03_trace/01_model.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/TomMonks/sim-tools" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/TomMonks/sim-tools/issues/new?title=Issue%20on%20page%20%2F03_trace/01_model.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/03_trace/01_model.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Advanced trace</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">1. Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constants-and-defaults-for-modelling-as-is">2. Constants and defaults for modelling <strong>as-is</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-parameters">2.1 Distribution parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-dependent-arrival-rates-data">2.2 Time dependent arrival rates data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resource-counts">2.3 Resource counts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-model-run-settings">2.4 Simulation model run settings</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-parameterisation">3. Model parameterisation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#patient-pathways-process-logic">6. Patient Pathways Process Logic</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#main-model-class">7. Main model class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logic-to-process-end-of-run-results">8. Logic to process end of run results.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-execution">9. Model execution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#single-run-of-the-model">9.1 Single run of the model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#disabling-trace-for-multiple-independent-replications">9.2 Disabling trace for multiple independent replications</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="advanced-trace">
<h1>Advanced trace<a class="headerlink" href="#advanced-trace" title="Link to this heading">#</a></h1>
<section id="imports">
<h2>1. Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<p>The model used to demonstrate trace functionality is implemented in <code class="docutils literal notranslate"><span class="pre">simpy</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">simpy</span>
<span class="n">simpy</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;4.1.1&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sim_tools</span>
<span class="n">sim_tools</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;0.7.0&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sim_tools.distributions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Exponential</span><span class="p">,</span> 
    <span class="n">Normal</span><span class="p">,</span> 
    <span class="n">Lognormal</span><span class="p">,</span> 
    <span class="n">Bernoulli</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sim_tools.time_dependent</span><span class="w"> </span><span class="kn">import</span> <span class="n">NSPPThinning</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sim_tools.trace</span><span class="w"> </span><span class="kn">import</span> <span class="n">Traceable</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="constants-and-defaults-for-modelling-as-is">
<h2>2. Constants and defaults for modelling <strong>as-is</strong><a class="headerlink" href="#constants-and-defaults-for-modelling-as-is" title="Link to this heading">#</a></h2>
<section id="distribution-parameters">
<h3>2.1 Distribution parameters<a class="headerlink" href="#distribution-parameters" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sign-in/triage parameters</span>
<span class="n">DEFAULT_TRIAGE_MEAN</span> <span class="o">=</span> <span class="mf">3.0</span>

<span class="c1"># registration parameters</span>
<span class="n">DEFAULT_REG_MEAN</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">DEFAULT_REG_VAR</span><span class="o">=</span> <span class="mf">2.0</span>

<span class="c1"># examination parameters</span>
<span class="n">DEFAULT_EXAM_MEAN</span> <span class="o">=</span> <span class="mf">16.0</span>
<span class="n">DEFAULT_EXAM_VAR</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">DEFAULT_EXAM_MIN</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c1"># trauma/stabilisation</span>
<span class="n">DEFAULT_TRAUMA_MEAN</span> <span class="o">=</span> <span class="mf">90.0</span>

<span class="c1"># Trauma treatment</span>
<span class="n">DEFAULT_TRAUMA_TREAT_MEAN</span> <span class="o">=</span> <span class="mf">30.0</span>
<span class="n">DEFAULT_TRAUMA_TREAT_VAR</span> <span class="o">=</span> <span class="mf">4.0</span>

<span class="c1"># Non trauma treatment</span>
<span class="n">DEFAULT_NON_TRAUMA_TREAT_MEAN</span> <span class="o">=</span> <span class="mf">13.3</span>
<span class="n">DEFAULT_NON_TRAUMA_TREAT_VAR</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="c1"># prob patient requires treatment given trauma</span>
<span class="n">DEFAULT_NON_TRAUMA_TREAT_P</span> <span class="o">=</span> <span class="mf">0.60</span>

<span class="c1"># proportion of patients triaged as trauma</span>
<span class="n">DEFAULT_PROB_TRAUMA</span> <span class="o">=</span> <span class="mf">0.12</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="time-dependent-arrival-rates-data">
<h3>2.2 Time dependent arrival rates data<a class="headerlink" href="#time-dependent-arrival-rates-data" title="Link to this heading">#</a></h3>
<p>The data for arrival rates varies between clinic opening at 6am and closure at 12am.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># data are held in the Github repo and loaded from there.</span>
<span class="n">NSPP_PATH</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/TomMonks/&#39;</span> \
 <span class="o">+</span> <span class="s1">&#39;open-science-for-sim/main/src/notebooks/01_foss_sim/data/ed_arrivals.csv&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="resource-counts">
<h3>2.3 Resource counts<a class="headerlink" href="#resource-counts" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>Inter count variables representing the number of resources at each activity in the processes.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DEFAULT_N_TRIAGE</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">DEFAULT_N_REG</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">DEFAULT_N_EXAM</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">DEFAULT_N_TRAUMA</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Non-trauma cubicles</span>
<span class="n">DEFAULT_N_CUBICLES_1</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># trauma pathway cubicles</span>
<span class="n">DEFAULT_N_CUBICLES_2</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="simulation-model-run-settings">
<h3>2.4 Simulation model run settings<a class="headerlink" href="#simulation-model-run-settings" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># default random number SET</span>
<span class="n">DEFAULT_RNG_SET</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">N_STREAMS</span> <span class="o">=</span> <span class="mi">20</span>

<span class="c1"># default results collection period</span>
<span class="n">DEFAULT_RESULTS_COLLECTION_PERIOD</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">19</span>

<span class="c1"># number of replications.</span>
<span class="n">DEFAULT_N_REPS</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1">## set to True to show a trace of the simulation model (best used in single run mode)</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># provide a list of integers that represent patient IDs.  Only these patients will be tracked</span>
<span class="n">TRACKED</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="model-parameterisation">
<h2>3. Model parameterisation<a class="headerlink" href="#model-parameterisation" title="Link to this heading">#</a></h2>
<p>For convienience a container class is used to hold the large number of model parameters.  The <code class="docutils literal notranslate"><span class="pre">Scenario</span></code> class includes defaults  these can easily be changed and at runtime to experiments with different designs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load_arrival_profile</span><span class="p">(</span><span class="n">profile_path</span><span class="p">):</span>

       <span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">profile_path</span><span class="p">)</span>
              <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
              <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;t&#39;</span><span class="p">})</span>
              <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">mean_iat</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">60.0</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">arrival_rate</span><span class="p">,</span>
                     <span class="n">t</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">t</span> <span class="o">*</span> <span class="mf">60.0</span><span class="p">)</span>
       <span class="p">)</span>
       <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">load_arrival_profile</span><span class="p">(</span><span class="n">NSPP_PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>t</th>
      <th>period</th>
      <th>arrival_rate</th>
      <th>mean_iat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>6AM-7AM</td>
      <td>2.366667</td>
      <td>25.352113</td>
    </tr>
    <tr>
      <th>1</th>
      <td>60.0</td>
      <td>7AM-8AM</td>
      <td>2.800000</td>
      <td>21.428571</td>
    </tr>
    <tr>
      <th>2</th>
      <td>120.0</td>
      <td>8AM-9AM</td>
      <td>8.833333</td>
      <td>6.792453</td>
    </tr>
    <tr>
      <th>3</th>
      <td>180.0</td>
      <td>9AM-10AM</td>
      <td>10.433333</td>
      <td>5.750799</td>
    </tr>
    <tr>
      <th>4</th>
      <td>240.0</td>
      <td>10AM-11AM</td>
      <td>14.800000</td>
      <td>4.054054</td>
    </tr>
    <tr>
      <th>5</th>
      <td>300.0</td>
      <td>11AM-12PM</td>
      <td>26.266667</td>
      <td>2.284264</td>
    </tr>
    <tr>
      <th>6</th>
      <td>360.0</td>
      <td>12PM-1PM</td>
      <td>31.400000</td>
      <td>1.910828</td>
    </tr>
    <tr>
      <th>7</th>
      <td>420.0</td>
      <td>1PM-2PM</td>
      <td>18.066667</td>
      <td>3.321033</td>
    </tr>
    <tr>
      <th>8</th>
      <td>480.0</td>
      <td>2PM-3PM</td>
      <td>16.466667</td>
      <td>3.643725</td>
    </tr>
    <tr>
      <th>9</th>
      <td>540.0</td>
      <td>3PM-4PM</td>
      <td>12.033333</td>
      <td>4.986150</td>
    </tr>
    <tr>
      <th>10</th>
      <td>600.0</td>
      <td>4PM-5PM</td>
      <td>11.600000</td>
      <td>5.172414</td>
    </tr>
    <tr>
      <th>11</th>
      <td>660.0</td>
      <td>5PM-6PM</td>
      <td>28.866667</td>
      <td>2.078522</td>
    </tr>
    <tr>
      <th>12</th>
      <td>720.0</td>
      <td>6PM-7PM</td>
      <td>18.033333</td>
      <td>3.327172</td>
    </tr>
    <tr>
      <th>13</th>
      <td>780.0</td>
      <td>7PM-8PM</td>
      <td>11.500000</td>
      <td>5.217391</td>
    </tr>
    <tr>
      <th>14</th>
      <td>840.0</td>
      <td>8PM-9PM</td>
      <td>5.300000</td>
      <td>11.320755</td>
    </tr>
    <tr>
      <th>15</th>
      <td>900.0</td>
      <td>9PM-10PM</td>
      <td>4.066667</td>
      <td>14.754098</td>
    </tr>
    <tr>
      <th>16</th>
      <td>960.0</td>
      <td>10PM-11PM</td>
      <td>2.200000</td>
      <td>27.272727</td>
    </tr>
    <tr>
      <th>17</th>
      <td>1020.0</td>
      <td>11PM-12AM</td>
      <td>2.100000</td>
      <td>28.571429</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Scenario</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Container class for scenario parameters/arguments</span>
<span class="sd">    </span>
<span class="sd">    Passed to a model and its process classes</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_number_set</span><span class="o">=</span><span class="n">DEFAULT_RNG_SET</span><span class="p">,</span>
                 <span class="n">n_triage</span><span class="o">=</span><span class="n">DEFAULT_N_TRIAGE</span><span class="p">,</span>
                 <span class="n">n_reg</span><span class="o">=</span><span class="n">DEFAULT_N_REG</span><span class="p">,</span>
                 <span class="n">n_exam</span><span class="o">=</span><span class="n">DEFAULT_N_EXAM</span><span class="p">,</span>
                 <span class="n">n_trauma</span><span class="o">=</span><span class="n">DEFAULT_N_TRAUMA</span><span class="p">,</span>
                 <span class="n">n_cubicles_1</span><span class="o">=</span><span class="n">DEFAULT_N_CUBICLES_1</span><span class="p">,</span>
                 <span class="n">n_cubicles_2</span><span class="o">=</span><span class="n">DEFAULT_N_CUBICLES_2</span><span class="p">,</span>
                 <span class="n">triage_mean</span><span class="o">=</span><span class="n">DEFAULT_TRIAGE_MEAN</span><span class="p">,</span>
                 <span class="n">reg_mean</span><span class="o">=</span><span class="n">DEFAULT_REG_MEAN</span><span class="p">,</span>
                 <span class="n">reg_var</span><span class="o">=</span><span class="n">DEFAULT_REG_VAR</span><span class="p">,</span>
                 <span class="n">exam_mean</span><span class="o">=</span><span class="n">DEFAULT_EXAM_MEAN</span><span class="p">,</span>
                 <span class="n">exam_var</span><span class="o">=</span><span class="n">DEFAULT_EXAM_VAR</span><span class="p">,</span>
                 <span class="n">exam_min</span><span class="o">=</span><span class="n">DEFAULT_EXAM_MIN</span><span class="p">,</span>
                 <span class="n">trauma_mean</span><span class="o">=</span><span class="n">DEFAULT_TRAUMA_MEAN</span><span class="p">,</span>
                 <span class="n">trauma_treat_mean</span><span class="o">=</span><span class="n">DEFAULT_TRAUMA_TREAT_MEAN</span><span class="p">,</span>
                 <span class="n">trauma_treat_var</span><span class="o">=</span><span class="n">DEFAULT_TRAUMA_TREAT_VAR</span><span class="p">,</span>
                 <span class="n">non_trauma_treat_mean</span><span class="o">=</span><span class="n">DEFAULT_NON_TRAUMA_TREAT_MEAN</span><span class="p">,</span>
                 <span class="n">non_trauma_treat_var</span><span class="o">=</span><span class="n">DEFAULT_NON_TRAUMA_TREAT_VAR</span><span class="p">,</span>
                 <span class="n">non_trauma_treat_p</span><span class="o">=</span><span class="n">DEFAULT_NON_TRAUMA_TREAT_P</span><span class="p">,</span>
                 <span class="n">prob_trauma</span><span class="o">=</span><span class="n">DEFAULT_PROB_TRAUMA</span><span class="p">,</span>
                 <span class="n">debug</span><span class="o">=</span><span class="n">DEBUG</span><span class="p">,</span>
                 <span class="n">tracked</span><span class="o">=</span><span class="n">TRACKED</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a scenario to parameterise the simulation model</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        random_number_set: int, optional (default=DEFAULT_RNG_SET)</span>
<span class="sd">            Set to control the initial seeds of each stream of pseudo</span>
<span class="sd">            random numbers used in the model.</span>
<span class="sd">        </span>
<span class="sd">        n_triage: int</span>
<span class="sd">            The number of triage cubicles</span>
<span class="sd">        </span>
<span class="sd">        n_reg: int</span>
<span class="sd">            The number of registration clerks</span>
<span class="sd">            </span>
<span class="sd">        n_exam: int</span>
<span class="sd">            The number of examination rooms</span>
<span class="sd">            </span>
<span class="sd">        n_trauma: int</span>
<span class="sd">            The number of trauma bays for stabilisation</span>
<span class="sd">            </span>
<span class="sd">        n_cubicles_1: int</span>
<span class="sd">            The number of non-trauma treatment cubicles</span>
<span class="sd">            </span>
<span class="sd">        n_cubicles_2: int</span>
<span class="sd">            The number of trauma treatment cubicles</span>
<span class="sd">            </span>
<span class="sd">        triage_mean: float</span>
<span class="sd">            Mean duration of the triage distribution (Exponential)</span>
<span class="sd">            </span>
<span class="sd">        reg_mean: float</span>
<span class="sd">            Mean duration of the registration distribution (Lognormal)</span>
<span class="sd">            </span>
<span class="sd">        reg_var: float</span>
<span class="sd">            Variance of the registration distribution (Lognormal)</span>
<span class="sd">            </span>
<span class="sd">        exam_mean: float</span>
<span class="sd">            Mean of the examination distribution (Normal)</span>
<span class="sd">            </span>
<span class="sd">        exam_var: float</span>
<span class="sd">            Variance of the examination distribution (Normal)</span>

<span class="sd">        exam_min: float</span>
<span class="sd">            The minimum value that an examination can take (Truncated Normal)</span>
<span class="sd">            </span>
<span class="sd">        trauma_mean: float</span>
<span class="sd">            Mean of the trauma stabilisation distribution (Exponential)</span>
<span class="sd">            </span>
<span class="sd">        trauma_treat_mean: float</span>
<span class="sd">            Mean of the trauma cubicle treatment distribution (Lognormal)</span>
<span class="sd">            </span>
<span class="sd">        trauma_treat_var: float</span>
<span class="sd">            Variance of the trauma cubicle treatment distribution (Lognormal)</span>
<span class="sd">        </span>
<span class="sd">        non_trauma_treat_mean: float</span>
<span class="sd">            Mean of the non trauma treatment distribution</span>
<span class="sd">            </span>
<span class="sd">        non_trauma_treat_var: float</span>
<span class="sd">            Variance of the non trauma treatment distribution</span>
<span class="sd">        </span>
<span class="sd">        non_trauma_treat_p: float</span>
<span class="sd">            Probability non trauma patient requires treatment</span>
<span class="sd">            </span>
<span class="sd">        prob_trauma: float</span>
<span class="sd">            probability that a new arrival is a trauma patient.</span>
<span class="sd">            </span>
<span class="sd">        debug: int</span>
<span class="sd">            Set to true to display a trace of simulated events in the model</span>
<span class="sd">            Note this is best used in single_run mode.</span>
<span class="sd">            </span>
<span class="sd">        tracked: list</span>
<span class="sd">            List of integers that represent patient IDs.</span>
<span class="sd">            Used with debug. If debug is True then only display trace for specific</span>
<span class="sd">            patients.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># sampling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_number_set</span> <span class="o">=</span> <span class="n">random_number_set</span>
        
        <span class="c1"># store parameters for sampling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">triage_mean</span> <span class="o">=</span> <span class="n">triage_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg_mean</span> <span class="o">=</span> <span class="n">reg_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg_var</span> <span class="o">=</span> <span class="n">reg_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exam_mean</span><span class="o">=</span> <span class="n">exam_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exam_var</span> <span class="o">=</span> <span class="n">exam_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exam_min</span> <span class="o">=</span> <span class="n">exam_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trauma_mean</span> <span class="o">=</span> <span class="n">trauma_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trauma_treat_mean</span> <span class="o">=</span> <span class="n">trauma_treat_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trauma_treat_var</span> <span class="o">=</span> <span class="n">trauma_treat_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_treat_mean</span> <span class="o">=</span> <span class="n">non_trauma_treat_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_treat_var</span> <span class="o">=</span> <span class="n">non_trauma_treat_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_treat_p</span> <span class="o">=</span> <span class="n">non_trauma_treat_p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_trauma</span> <span class="o">=</span> <span class="n">prob_trauma</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">init_sampling</span><span class="p">()</span>
        
        <span class="c1"># count of each type of resource</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_resourse_counts</span><span class="p">(</span><span class="n">n_triage</span><span class="p">,</span> <span class="n">n_reg</span><span class="p">,</span> <span class="n">n_exam</span><span class="p">,</span> <span class="n">n_trauma</span><span class="p">,</span>
                                  <span class="n">n_cubicles_1</span><span class="p">,</span> <span class="n">n_cubicles_2</span><span class="p">)</span>
        
        <span class="c1"># debug/trace information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracked</span> <span class="o">=</span> <span class="n">tracked</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">set_random_no_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_number_set</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Controls the random sampling </span>
<span class="sd">        Parameters:</span>
<span class="sd">        ----------</span>
<span class="sd">        random_number_set: int</span>
<span class="sd">            Used to control the set of pseudo random numbers</span>
<span class="sd">            used by the distributions in the simulation.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_number_set</span> <span class="o">=</span> <span class="n">random_number_set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_sampling</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init_resourse_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_triage</span><span class="p">,</span> <span class="n">n_reg</span><span class="p">,</span> <span class="n">n_exam</span><span class="p">,</span> <span class="n">n_trauma</span><span class="p">,</span>
                             <span class="n">n_cubicles_1</span><span class="p">,</span> <span class="n">n_cubicles_2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Init the counts of resources to default values...</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_triage</span> <span class="o">=</span> <span class="n">n_triage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_reg</span> <span class="o">=</span> <span class="n">n_reg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_exam</span> <span class="o">=</span> <span class="n">n_exam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_trauma</span> <span class="o">=</span> <span class="n">n_trauma</span>
        
        <span class="c1"># non-trauma (1), trauma (2) treatment cubicles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_cubicles_1</span> <span class="o">=</span> <span class="n">n_cubicles_1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_cubicles_2</span> <span class="o">=</span> <span class="n">n_cubicles_2</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init_sampling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create the distributions used by the model and initialise </span>
<span class="sd">        the random seeds of each.</span>
<span class="sd">        &#39;&#39;&#39;</span>       
        <span class="c1"># MODIFICATION. Better method for producing n non-overlapping streams</span>
        <span class="n">seed_sequence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">SeedSequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">random_number_set</span><span class="p">)</span>
    
        <span class="c1"># Generate n high quality child seeds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seeds</span> <span class="o">=</span> <span class="n">seed_sequence</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">N_STREAMS</span><span class="p">)</span>
        
        <span class="c1"># create distributions</span>
        
        <span class="c1"># Triage duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">triage_dist</span> <span class="o">=</span> <span class="n">Exponential</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">triage_mean</span><span class="p">,</span> 
                                       <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="c1"># Registration duration (non-trauma only)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg_dist</span> <span class="o">=</span> <span class="n">Lognormal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg_mean</span><span class="p">,</span> 
                                  <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg_var</span><span class="p">),</span>
                                  <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="c1"># Evaluation (non-trauma only)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exam_dist</span> <span class="o">=</span> <span class="n">Normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exam_mean</span><span class="p">,</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exam_var</span><span class="p">),</span>
                                <span class="n">minimum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exam_min</span><span class="p">,</span>
                                <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        
        <span class="c1"># Trauma/stablisation duration (trauma only)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trauma_dist</span> <span class="o">=</span> <span class="n">Exponential</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trauma_mean</span><span class="p">,</span> 
                                       <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        
        <span class="c1"># Non-trauma treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nt_treat_dist</span> <span class="o">=</span> <span class="n">Lognormal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_treat_mean</span><span class="p">,</span> 
                                       <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_treat_var</span><span class="p">),</span>
                                       <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        
        <span class="c1"># treatment of trauma patients</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treat_dist</span> <span class="o">=</span> <span class="n">Lognormal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trauma_treat_mean</span><span class="p">,</span> 
                                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trauma_treat_var</span><span class="p">),</span>
                                    <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
        
        <span class="c1"># probability of non-trauma patient requiring treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nt_p_treat_dist</span> <span class="o">=</span> <span class="n">Bernoulli</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_treat_p</span><span class="p">,</span> 
                                         <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
        
        
        <span class="c1"># probability of non-trauma versus trauma patient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_trauma_dist</span> <span class="o">=</span> <span class="n">Bernoulli</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_trauma</span><span class="p">,</span> 
                                       <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        
        <span class="c1"># init sampling for non-stationary poisson process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_nspp</span><span class="p">()</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">init_nspp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="c1"># read arrival profile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrivals</span> <span class="o">=</span> <span class="n">load_arrival_profile</span><span class="p">(</span><span class="n">NSPP_PATH</span><span class="p">)</span>

        <span class="c1"># maximum arrival rate (smallest time between arrivals)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lambda_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrivals</span><span class="p">[</span><span class="s1">&#39;arrival_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        
        <span class="c1"># NSPP thinning distribution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thinning_dist</span> <span class="o">=</span> <span class="n">NSPPThinning</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrivals</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="patient-pathways-process-logic">
<h2>6. Patient Pathways Process Logic<a class="headerlink" href="#patient-pathways-process-logic" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">simpy</span></code> uses a process based worldview.  We can easily create whatever logic - simple or complex  for the model.  Here the process logic for trauma and non-trauma patients is seperated into two classes <code class="docutils literal notranslate"><span class="pre">TraumaPathway</span></code>  and <code class="docutils literal notranslate"><span class="pre">NonTraumaPathway</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TraumaPathway</span><span class="p">(</span><span class="n">Traceable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Encapsulates the process a patient with severe injuries or illness.</span>
<span class="sd">    </span>
<span class="sd">    These patients are signed into the ED and triaged as having severe injuries</span>
<span class="sd">    or illness.</span>
<span class="sd">    </span>
<span class="sd">    Patients are stabilised in resus (trauma) and then sent to Treatment.  </span>
<span class="sd">    Following treatment they are discharged.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor method</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        -----</span>
<span class="sd">        identifier: int</span>
<span class="sd">            a numeric identifier for the patient.</span>
<span class="sd">            </span>
<span class="sd">        env: simpy.Environment</span>
<span class="sd">            the simulation environment</span>
<span class="sd">            </span>
<span class="sd">        args: Scenario</span>
<span class="sd">            Container class for the simulation parameters</span>
<span class="sd">            </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># initialise Trace</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        
        <span class="c1"># metrics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_triage</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_trauma</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_treat</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">triage_duration</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trauma_duration</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treat_duration</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        simulates the major treatment process for a patient</span>
<span class="sd">        </span>
<span class="sd">        1. request and wait for sign-in/triage</span>
<span class="sd">        2. trauma</span>
<span class="sd">        3. treatment</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># record the time of arrival and entered the triage queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trauma_arrival</span><span class="p">()</span>
        
        <span class="c1"># request sign-in/triage </span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">triage</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">req</span>
            <span class="c1"># record the waiting time for triage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_triage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span>     
            
            <span class="c1"># triage begin event</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">triage_begin</span><span class="p">()</span>
        
            <span class="c1"># sample triage duration.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">triage_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">triage_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">triage_duration</span><span class="p">)</span>
            
            <span class="c1"># triage complete event</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">triage_complete</span><span class="p">()</span>
            
        <span class="c1"># record the time that entered the trauma queue</span>
        <span class="n">start_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
    
        <span class="c1"># request trauma room </span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">trauma</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">req</span>
            
            <span class="c1"># record the waiting time for trauma</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_trauma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">start_wait</span>
            
            <span class="c1"># trauma begin event</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trauma_begin</span><span class="p">()</span>
            
            <span class="c1"># sample stablisation duration.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trauma_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">trauma_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trauma_duration</span><span class="p">)</span>
            
            <span class="c1"># trauma complete event</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trauma_complete</span><span class="p">()</span>
            
        <span class="c1"># record the time that entered the treatment queue</span>
        <span class="n">start_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
    
        <span class="c1"># request treatment cubicle </span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">cubicle_2</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">req</span>
            
            <span class="c1"># record the waiting time for trauma</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_treat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">start_wait</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">treatment_begin</span><span class="p">()</span>
            
            <span class="c1"># sample treatment duration.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">treat_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">treat_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treat_duration</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">treatment_complete</span><span class="p">()</span>
        
        <span class="c1"># total time in system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span>     
    
    <span class="k">def</span><span class="w"> </span><span class="nf">trauma_arrival</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Trauma arrival event&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s1">&#39;arrival at centre 🚑&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">triage_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Enter triage event&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;enter triage. Waiting time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_triage</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> 
                   <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
          
    <span class="k">def</span><span class="w"> </span><span class="nf">trauma_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Enter trauma stabilisation&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;enter stabilisation. Waiting time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_trauma</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> 
                   <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">treatment_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Enter trauma treatment post stabilisation&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;enter treatment. Waiting time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_treat</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> 
                   <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">triage_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Triage complete event&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s1">&#39;triage complete&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
          
    <span class="k">def</span><span class="w"> </span><span class="nf">trauma_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Patient stay in trauma is complete.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s1">&#39;stabilisation complete.&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">treatment_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Treatment complete event&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;patient </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1"> treatment complete; &#39;</span>
                   <span class="sa">f</span><span class="s1">&#39;waiting time was </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_treat</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_trace_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Override trace config&#39;&#39;&#39;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Trauma&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;name_colour&quot;</span><span class="p">:</span><span class="s2">&quot;bold magenta&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;time_colour&quot;</span><span class="p">:</span><span class="s1">&#39;bold magenta&#39;</span><span class="p">,</span> 
            <span class="s2">&quot;tracked&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">tracked</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">config</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NonTraumaPathway</span><span class="p">(</span><span class="n">Traceable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Encapsulates the process a patient with minor injuries and illness.</span>
<span class="sd">    </span>
<span class="sd">    These patients are signed into the ED and triaged as having minor </span>
<span class="sd">    complaints and streamed to registration and then examination. </span>
<span class="sd">    </span>
<span class="sd">    Post examination 40% are discharged while 60% proceed to treatment.  </span>
<span class="sd">    Following treatment they are discharged.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor method</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        -----</span>
<span class="sd">        identifier: int</span>
<span class="sd">            a numeric identifier for the patient.</span>
<span class="sd">            </span>
<span class="sd">        env: simpy.Environment</span>
<span class="sd">            the simulation environment</span>
<span class="sd">            </span>
<span class="sd">        args: Scenario</span>
<span class="sd">            Container class for the simulation parameters</span>
<span class="sd">            </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        
        <span class="c1"># triage resource</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">triage</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">triage</span>
        
        <span class="c1"># metrics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_triage</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_reg</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_exam</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_treat</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">triage_duration</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg_duration</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exam_duration</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treat_duration</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        
        
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        simulates the non-trauma/minor treatment process for a patient</span>
<span class="sd">        </span>
<span class="sd">        1. request and wait for sign-in/triage</span>
<span class="sd">        2. patient registration</span>
<span class="sd">        3. examination</span>
<span class="sd">        4. split patients</span>
<span class="sd">        4.1 % discharged</span>
<span class="sd">        4.2 % treatment then discharge</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># record the time of arrival and entered the triage queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
        
        <span class="c1"># trace arrival</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s1">&#39;arrival to centre.&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>

        <span class="c1"># request sign-in/triage </span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">triage</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">req</span>
            
            <span class="c1"># record the waiting time for triage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_triage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span>
            
            <span class="c1"># trace enter triage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s1">&#39;entering triage. &#39;</span>
                       <span class="sa">f</span><span class="s1">&#39;Waiting time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_triage</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> mins&#39;</span><span class="p">,</span> 
                       <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
                        
                        
            <span class="c1"># sample triage duration.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">triage_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">triage_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">triage_duration</span><span class="p">)</span>
            
            <span class="c1"># trace exit triage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s1">&#39;triage complete&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
                        
        <span class="c1"># record the time that entered the registration queue</span>
        <span class="n">start_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
    
        <span class="c1"># request registration clert </span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">req</span>
            
            <span class="c1"># record the waiting time for registration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_reg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">start_wait</span>
            
            <span class="c1"># trace begin registration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s1">&#39;starting patient registration.&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
            
            <span class="c1"># sample registration duration.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reg_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">reg_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg_duration</span><span class="p">)</span>
            
            <span class="c1"># registration complete...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s1">&#39;patient registered;&#39;</span>
                       <span class="sa">f</span><span class="s1">&#39;waiting time was </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_triage</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> 
                       <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
            
        <span class="c1"># record the time that entered the evaluation queue</span>
        <span class="n">start_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
    
        <span class="c1"># request examination resource</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">exam</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">req</span>
            
            <span class="c1"># record the waiting time for registration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_exam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">start_wait</span>
            
             <span class="c1"># trace begin examination</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;enter examination. Waiting time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_exam</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> 
                       <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
            
            <span class="c1"># sample examination duration.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exam_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">exam_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exam_duration</span><span class="p">)</span>
            
            <span class="c1"># trace exit examination</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s1">&#39;examination complete.&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
            
        <span class="c1"># sample if patient requires treatment?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">require_treat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nt_p_treat_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">require_treat</span><span class="p">:</span>
        
            <span class="c1"># record the time that entered the treatment queue</span>
            <span class="n">start_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
    
            <span class="c1"># request treatment cubicle</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">cubicle_1</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">req</span>

                <span class="c1"># record the waiting time for treatment</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wait_treat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">start_wait</span>
                
                <span class="c1"># trace enter treatment</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;enter treatment. Waiting time:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_treat</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
        
                <span class="c1"># sample treatment duration.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">treat_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nt_treat_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treat_duration</span><span class="p">)</span>

                <span class="c1"># trace exit treatment</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s1">&#39;treatment complete ⛔&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
                
        <span class="c1"># total time in system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span>      
        
    <span class="k">def</span><span class="w"> </span><span class="nf">_trace_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Override trace config&#39;&#39;&#39;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Non-trauma&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;name_colour&quot;</span><span class="p">:</span><span class="s2">&quot;bold green&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;time_colour&quot;</span><span class="p">:</span><span class="s1">&#39;bold green&#39;</span><span class="p">,</span> 
            <span class="s2">&quot;message_colour&quot;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="s2">&quot;tracked&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">tracked</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">config</span>
    
</pre></div>
</div>
</div>
</div>
</section>
<section id="main-model-class">
<h2>7. Main model class<a class="headerlink" href="#main-model-class" title="Link to this heading">#</a></h2>
<p>The main class that a user interacts with to run the model is <code class="docutils literal notranslate"><span class="pre">TreatmentCentreModel</span></code>.  This implements a <code class="docutils literal notranslate"><span class="pre">.run()</span></code> method, contains a simple algorithm for the non-stationary poission process for patients arrivals and inits instances of <code class="docutils literal notranslate"><span class="pre">TraumaPathway</span></code> or <code class="docutils literal notranslate"><span class="pre">NonTraumaPathway</span></code> depending on the arrival type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TreatmentCentreModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The treatment centre model</span>
<span class="sd">    </span>
<span class="sd">    Patients arrive at random to a treatment centre, are triaged</span>
<span class="sd">    and then processed in either a trauma or non-trauma pathway.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_resources</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">patients</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trauma_patients</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_patients</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rc_period</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">init_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Init the number of resources</span>
<span class="sd">        and store in the arguments container object</span>
<span class="sd">        </span>
<span class="sd">        Resource list:</span>
<span class="sd">        1. Sign-in/triage bays</span>
<span class="sd">        2. registration clerks</span>
<span class="sd">        3. examination bays</span>
<span class="sd">        4. trauma bays</span>
<span class="sd">        5. non-trauma cubicles (1)</span>
<span class="sd">        6. trauma cubicles (2)</span>
<span class="sd">         </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># sign/in triage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">triage</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> 
                                          <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_triage</span><span class="p">)</span>
        
        <span class="c1"># registration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">registration</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> 
                                                <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_reg</span><span class="p">)</span>
        
        <span class="c1"># examination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">exam</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> 
                                        <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_exam</span><span class="p">)</span>
        
        <span class="c1"># trauma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">trauma</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> 
                                          <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_trauma</span><span class="p">)</span>
        
        <span class="c1"># non-trauma treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">cubicle_1</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> 
                                              <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_cubicles_1</span><span class="p">)</span>
            
        <span class="c1"># trauma treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">cubicle_2</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> 
                                              <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_cubicles_2</span><span class="p">)</span>
        
        
        
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_collection_period</span><span class="o">=</span><span class="n">DEFAULT_RESULTS_COLLECTION_PERIOD</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Conduct a single run of the model in its current </span>
<span class="sd">        configuration</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        ----------</span>
<span class="sd">        results_collection_period, float, optional</span>
<span class="sd">            default = DEFAULT_RESULTS_COLLECTION_PERIOD</span>
<span class="sd">            </span>
<span class="sd">        warm_up, float, optional (default=0)</span>
<span class="sd">        </span>
<span class="sd">            length of initial transient period to truncate</span>
<span class="sd">            from results.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># setup the arrival generator process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrivals_generator</span><span class="p">())</span>
        
        <span class="c1"># store rc perio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rc_period</span> <span class="o">=</span> <span class="n">results_collection_period</span>
        
        <span class="c1"># run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">results_collection_period</span><span class="p">)</span>
        
    
    <span class="k">def</span><span class="w"> </span><span class="nf">arrivals_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
<span class="w">        </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Simulate the arrival of patients to the model</span>
<span class="sd">        </span>
<span class="sd">        Patients either follow a TraumaPathway or</span>
<span class="sd">        NonTraumaPathway simpy process.</span>
<span class="sd">        </span>
<span class="sd">        Non stationary arrivals implemented via Thinning acceptance-rejection </span>
<span class="sd">        algorithm.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">patient_count</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>

            <span class="c1"># sample iat via thinning</span>
            <span class="n">interarrival_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">thinning_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>

            <span class="c1"># delay until next arrival</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">interarrival_time</span><span class="p">)</span>
            
            <span class="c1"># sample if the patient is trauma or non-trauma</span>
            <span class="n">trauma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">p_trauma_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">trauma</span><span class="p">:</span>
                <span class="c1"># create and store a trauma patient to update KPIs.</span>
                <span class="n">new_patient</span> <span class="o">=</span> <span class="n">TraumaPathway</span><span class="p">(</span><span class="n">patient_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trauma_patients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_patient</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># create and store a non-trauma patient to update KPIs.</span>
                <span class="n">new_patient</span> <span class="o">=</span> <span class="n">NonTraumaPathway</span><span class="p">(</span><span class="n">patient_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_patient</span><span class="p">)</span>
                
            <span class="c1"># start the pathway process for the patient</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">new_patient</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<section id="logic-to-process-end-of-run-results">
<h3>8. Logic to process end of run results.<a class="headerlink" href="#logic-to-process-end-of-run-results" title="Link to this heading">#</a></h3>
<p>the class <code class="docutils literal notranslate"><span class="pre">SimulationSummary</span></code> accepts a <code class="docutils literal notranslate"><span class="pre">TraumaCentreModel</span></code>.  At the end of a run it can be used calculate mean queuing times and the percentage of the total run that a resource was in use.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SimulationSummary</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    End of run result processing logic of the simulation model</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        ------</span>
<span class="sd">        model: TraumaCentreModel</span>
<span class="sd">            The model.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">process_run_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculates statistics at end of run.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># list of all patients </span>
        <span class="n">patients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">trauma_patients</span>
        
        <span class="c1"># mean triage times (both types of patient)</span>
        <span class="n">mean_triage_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;wait_triage&#39;</span><span class="p">,</span> <span class="n">patients</span><span class="p">)</span>
        
        <span class="c1"># triage utilisation (both types of patient)</span>
        <span class="n">triage_util</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_util</span><span class="p">(</span><span class="s1">&#39;triage_duration&#39;</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_triage</span><span class="p">,</span> 
                                             <span class="n">patients</span><span class="p">)</span>
        
        <span class="c1"># mean waiting time for registration (non_trauma)</span>
        <span class="n">mean_reg_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;wait_reg&#39;</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># registration utilisation (trauma)</span>
        <span class="n">reg_util</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_util</span><span class="p">(</span><span class="s1">&#39;reg_duration&#39;</span><span class="p">,</span> 
                                          <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_reg</span><span class="p">,</span> 
                                          <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># mean waiting time for examination (non_trauma)</span>
        <span class="n">mean_wait_exam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;wait_exam&#39;</span><span class="p">,</span> 
                                              <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># examination utilisation (non-trauma)</span>
        <span class="n">exam_util</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_util</span><span class="p">(</span><span class="s1">&#39;exam_duration&#39;</span><span class="p">,</span> 
                                            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_exam</span><span class="p">,</span> 
                                            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="p">)</span>
        
        
        <span class="c1"># mean waiting time for treatment (non-trauma) </span>
        <span class="n">mean_treat_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;wait_treat&#39;</span><span class="p">,</span> 
                                               <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># treatment utilisation (non_trauma)</span>
        <span class="n">treat_util1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_util</span><span class="p">(</span><span class="s1">&#39;treat_duration&#39;</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_cubicles_1</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># mean total time (non_trauma)</span>
        <span class="n">mean_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;total_time&#39;</span><span class="p">,</span> 
                                          <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="p">)</span>
                                    
        <span class="c1"># mean waiting time for trauma </span>
        <span class="n">mean_trauma_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;wait_trauma&#39;</span><span class="p">,</span> 
                                                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># trauma utilisation (trauma)</span>
        <span class="n">trauma_util</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_util</span><span class="p">(</span><span class="s1">&#39;trauma_duration&#39;</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_trauma</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># mean waiting time for treatment (rauma) </span>
        <span class="n">mean_treat_wait2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;wait_treat&#39;</span><span class="p">,</span> 
                                                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># treatment utilisation (trauma)</span>
        <span class="n">treat_util2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_util</span><span class="p">(</span><span class="s1">&#39;treat_duration&#39;</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_cubicles_2</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">trauma_patients</span><span class="p">)</span>

        <span class="c1"># mean total time (trauma)</span>
        <span class="n">mean_total2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;total_time&#39;</span><span class="p">,</span> 
                                           <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">trauma_patients</span><span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;00_arrivals&#39;</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">patients</span><span class="p">),</span>
                        <span class="s1">&#39;01a_triage_wait&#39;</span><span class="p">:</span> <span class="n">mean_triage_wait</span><span class="p">,</span>
                        <span class="s1">&#39;01b_triage_util&#39;</span><span class="p">:</span> <span class="n">triage_util</span><span class="p">,</span>
                        <span class="s1">&#39;02a_registration_wait&#39;</span><span class="p">:</span><span class="n">mean_reg_wait</span><span class="p">,</span>
                        <span class="s1">&#39;02b_registration_util&#39;</span><span class="p">:</span> <span class="n">reg_util</span><span class="p">,</span>
                        <span class="s1">&#39;03a_examination_wait&#39;</span><span class="p">:</span><span class="n">mean_wait_exam</span><span class="p">,</span>
                        <span class="s1">&#39;03b_examination_util&#39;</span><span class="p">:</span> <span class="n">exam_util</span><span class="p">,</span>
                        <span class="s1">&#39;04a_treatment_wait(non_trauma)&#39;</span><span class="p">:</span><span class="n">mean_treat_wait</span><span class="p">,</span>
                        <span class="s1">&#39;04b_treatment_util(non_trauma)&#39;</span><span class="p">:</span><span class="n">treat_util1</span><span class="p">,</span>
                        <span class="s1">&#39;05_total_time(non-trauma)&#39;</span><span class="p">:</span><span class="n">mean_total</span><span class="p">,</span>
                        <span class="s1">&#39;06a_trauma_wait&#39;</span><span class="p">:</span><span class="n">mean_trauma_wait</span><span class="p">,</span>
                        <span class="s1">&#39;06b_trauma_util&#39;</span><span class="p">:</span><span class="n">trauma_util</span><span class="p">,</span>
                        <span class="s1">&#39;07a_treatment_wait(trauma)&#39;</span><span class="p">:</span><span class="n">mean_treat_wait2</span><span class="p">,</span>
                        <span class="s1">&#39;07b_treatment_util(trauma)&#39;</span><span class="p">:</span><span class="n">treat_util2</span><span class="p">,</span>
                        <span class="s1">&#39;08_total_time(trauma)&#39;</span><span class="p">:</span><span class="n">mean_total2</span><span class="p">,</span>
                        <span class="s1">&#39;09_throughput&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_throughput</span><span class="p">(</span><span class="n">patients</span><span class="p">)}</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">get_mean_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">patients</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate mean of the performance measure for the</span>
<span class="sd">        select cohort of patients,</span>
<span class="sd">        </span>
<span class="sd">        Only calculates metrics for patients where it has been </span>
<span class="sd">        measured.</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        -------</span>
<span class="sd">        metric: str</span>
<span class="sd">            The name of the metric e.g. &#39;wait_treat&#39;</span>
<span class="sd">            </span>
<span class="sd">        patients: list</span>
<span class="sd">            A list of patients</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patients</span> 
                         <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mean</span>
    
    
    <span class="k">def</span><span class="w"> </span><span class="nf">get_resource_util</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">n_resources</span><span class="p">,</span> <span class="n">patients</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate proportion of the results collection period</span>
<span class="sd">        where a resource was in use.</span>
<span class="sd">        </span>
<span class="sd">        Done by tracking the duration by patient.</span>
<span class="sd">        </span>
<span class="sd">        Only calculates metrics for patients where it has been </span>
<span class="sd">        measured.</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        -------</span>
<span class="sd">        metric: str</span>
<span class="sd">            The name of the metric e.g. &#39;treatment_duration&#39;</span>
<span class="sd">            </span>
<span class="sd">        patients: list</span>
<span class="sd">            A list of patients</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patients</span> 
                         <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> 
        
        <span class="k">return</span> <span class="n">total</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">rc_period</span> <span class="o">*</span> <span class="n">n_resources</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">get_throughput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patients</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the total number of patients that have successfully</span>
<span class="sd">        been processed and discharged in the treatment centre</span>
<span class="sd">        (they have a total time record)</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        -------</span>
<span class="sd">        patients: list</span>
<span class="sd">            list of all patient objects simulated.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        ------</span>
<span class="sd">        float</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patients</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">total_time</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">summary_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns run results as a pandas.DataFrame</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#append to results df</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_run_results</span><span class="p">()</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;1&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">})</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">T</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;rep&#39;</span>
        <span class="k">return</span> <span class="n">df</span>
    
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="model-execution">
<h2>9. Model execution<a class="headerlink" href="#model-execution" title="Link to this heading">#</a></h2>
<p>We note that there are <strong>many ways</strong> to setup a <code class="docutils literal notranslate"><span class="pre">simpy</span></code> model and execute it (that is part of its fantastic flexibility).  The organisation of code we show below is based on our experience of using the package in practice. The approach also allows for easy parallisation over multiple CPU cores using <code class="docutils literal notranslate"><span class="pre">joblib</span></code>.</p>
<p>We include two functions. <code class="docutils literal notranslate"><span class="pre">single_run()</span></code> and <code class="docutils literal notranslate"><span class="pre">multiple_replications</span></code>.  The latter is used to repeatedly call and process the results from <code class="docutils literal notranslate"><span class="pre">single_run</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">single_run</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">rc_period</span><span class="o">=</span><span class="n">DEFAULT_RESULTS_COLLECTION_PERIOD</span><span class="p">,</span> 
               <span class="n">random_no_set</span><span class="o">=</span><span class="n">DEFAULT_RNG_SET</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Perform a single run of the model and return the results</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    </span>
<span class="sd">    scenario: Scenario object</span>
<span class="sd">        The scenario/paramaters to run</span>
<span class="sd">        </span>
<span class="sd">    rc_period: int</span>
<span class="sd">        The length of the simulation run that collects results</span>
<span class="sd">        </span>
<span class="sd">    random_no_set: int or None, optional (default=DEFAULT_RNG_SET)</span>
<span class="sd">        Controls the set of random seeds used by the stochastic parts of the </span>
<span class="sd">        model.  Set to different ints to get different results.  Set to None</span>
<span class="sd">        for a random set of seeds.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">        pandas.DataFrame:</span>
<span class="sd">        results from single run.</span>
<span class="sd">    &#39;&#39;&#39;</span>  
        
    <span class="c1"># set random number set - this controls sampling for the run.</span>
    <span class="n">scenario</span><span class="o">.</span><span class="n">set_random_no_set</span><span class="p">(</span><span class="n">random_no_set</span><span class="p">)</span>

    <span class="c1"># create an instance of the model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">TreatmentCentreModel</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>

    <span class="c1"># run the model</span>
    <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">results_collection_period</span><span class="o">=</span><span class="n">rc_period</span><span class="p">)</span>
        
    <span class="c1"># run results</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">SimulationSummary</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">summary_df</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="n">summary_frame</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">summary_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">multiple_replications</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">rc_period</span><span class="o">=</span><span class="n">DEFAULT_RESULTS_COLLECTION_PERIOD</span><span class="p">,</span> 
                          <span class="n">n_reps</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Perform multiple replications of the model.</span>
<span class="sd">    </span>
<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    scenario: Scenario</span>
<span class="sd">        Parameters/arguments to configurethe model</span>
<span class="sd">    </span>
<span class="sd">    rc_period: float, optional (default=DEFAULT_RESULTS_COLLECTION_PERIOD)</span>
<span class="sd">        results collection period.  </span>
<span class="sd">        the number of minutes to run the model to collect results</span>

<span class="sd">    n_reps: int, optional (default=DEFAULT_N_REPS)</span>
<span class="sd">        Number of independent replications to run.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">single_run</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">rc_period</span><span class="p">,</span> <span class="n">random_no_set</span><span class="o">=</span><span class="n">rep</span><span class="p">)</span> 
               <span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_reps</span><span class="p">)]</span>
    
    <span class="c1">#format and return results in a dataframe</span>
    <span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">df_results</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_results</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df_results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;rep&#39;</span>
    <span class="k">return</span> <span class="n">df_results</span>
</pre></div>
</div>
</div>
</div>
<section id="single-run-of-the-model">
<h3>9.1 Single run of the model<a class="headerlink" href="#single-run-of-the-model" title="Link to this heading">#</a></h3>
<p>The script below performs a single replication of the simulation model.</p>
<p><strong>Try:</strong></p>
<ul class="simple">
<li><p>Changing the <code class="docutils literal notranslate"><span class="pre">random_no_set</span></code> of the <code class="docutils literal notranslate"><span class="pre">single_run</span></code> call.</p></li>
<li><p>Assigning the value <code class="docutils literal notranslate"><span class="pre">True</span></code> to <code class="docutils literal notranslate"><span class="pre">debug</span></code></p></li>
<li><p>Tracking patient arrivals 10 and 19 through the model by setting <code class="docutils literal notranslate"><span class="pre">tracked=[10,</span> <span class="pre">19]</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create the default scenario. </span>
<span class="n">args</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tracked</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">19</span><span class="p">])</span>

<span class="c1"># use the single_run() func</span>
<span class="c1"># try changing `random_no_set` to see different run results</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Running simulation ...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; =&gt; &#39;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">single_run</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">random_no_set</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;simulation complete.&#39;</span><span class="p">)</span>

<span class="c1"># show results (transpose replication for easier view)</span>
<span class="n">results</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running simulation ... =&gt; 
</pre></div>
</div>
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">169.77</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">arrival to centre.</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">175.62</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">entering triage. Waiting time: </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">5.849</span><span style="color: #000000; text-decoration-color: #000000"> mins</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">175.79</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">triage complete</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">188.70</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">starting patient registration.</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">193.51</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">patient registered;waiting time was </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">5.849</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">193.51</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">enter examination. Waiting time: </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">0.000</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">[</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">204.96</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">arrival at centre 🚑</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">208.94</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">examination complete.</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">208.94</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">enter treatment. Waiting tim</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">e:0</span><span style="color: #000000; text-decoration-color: #000000">.</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">000</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">[</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">214.79</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">enter triage. Waiting time: </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">9.833</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">[</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">221.03</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">triage complete</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">221.63</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">treatment complete ⛔</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">[</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">384.82</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">enter stabilisation. Waiting time: </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">163.799</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">[</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">441.65</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">stabilisation complete.</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">[</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">473.10</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">enter treatment. Waiting time: </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">31.447</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">[</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">505.03</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">]:</span><span style="color: #000000; text-decoration-color: #000000">patient </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">19</span><span style="color: #000000; text-decoration-color: #000000"> treatment complete; waiting time was </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">31.447</span>
</pre>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>simulation complete.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>rep</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>00_arrivals</th>
      <td>209.000000</td>
    </tr>
    <tr>
      <th>01a_triage_wait</th>
      <td>16.622674</td>
    </tr>
    <tr>
      <th>01b_triage_util</th>
      <td>0.527512</td>
    </tr>
    <tr>
      <th>02a_registration_wait</th>
      <td>111.161345</td>
    </tr>
    <tr>
      <th>02b_registration_util</th>
      <td>0.801061</td>
    </tr>
    <tr>
      <th>03a_examination_wait</th>
      <td>24.927965</td>
    </tr>
    <tr>
      <th>03b_examination_util</th>
      <td>0.851285</td>
    </tr>
    <tr>
      <th>04a_treatment_wait(non_trauma)</th>
      <td>172.435861</td>
    </tr>
    <tr>
      <th>04b_treatment_util(non_trauma)</th>
      <td>0.845652</td>
    </tr>
    <tr>
      <th>05_total_time(non-trauma)</th>
      <td>248.848441</td>
    </tr>
    <tr>
      <th>06a_trauma_wait</th>
      <td>201.144403</td>
    </tr>
    <tr>
      <th>06b_trauma_util</th>
      <td>0.919830</td>
    </tr>
    <tr>
      <th>07a_treatment_wait(trauma)</th>
      <td>22.620880</td>
    </tr>
    <tr>
      <th>07b_treatment_util(trauma)</th>
      <td>0.493576</td>
    </tr>
    <tr>
      <th>08_total_time(trauma)</th>
      <td>310.384648</td>
    </tr>
    <tr>
      <th>09_throughput</th>
      <td>155.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="disabling-trace-for-multiple-independent-replications">
<h3>9.2 Disabling trace for multiple independent replications<a class="headerlink" href="#disabling-trace-for-multiple-independent-replications" title="Link to this heading">#</a></h3>
<p><strong>Important</strong>: set <code class="docutils literal notranslate"><span class="pre">debug=False</span></code> in <code class="docutils literal notranslate"><span class="pre">Scenario</span></code> for multiple replications. This will ensure that each replication is not traced.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">args</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1">#run multiple replications.</span>
<span class="n">results</span>  <span class="o">=</span> <span class="n">multiple_replications</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">n_reps</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All replications complete.&quot;</span><span class="p">)</span>

<span class="c1"># summarise the results (2.dp)</span>
<span class="n">results</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>All replications complete.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>00_arrivals                       227.72
01a_triage_wait                    35.24
01b_triage_util                     0.61
02a_registration_wait             105.57
02b_registration_util               0.84
03a_examination_wait               25.55
03b_examination_util                0.85
04a_treatment_wait(non_trauma)    136.66
04b_treatment_util(non_trauma)      0.87
05_total_time(non-trauma)         234.34
06a_trauma_wait                   151.68
06b_trauma_util                     0.83
07a_treatment_wait(trauma)         14.31
07b_treatment_util(trauma)          0.50
08_total_time(trauma)             292.28
09_throughput                     162.16
dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "TomMonks/sim-tools",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./03_trace"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="01_simple_trace.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">A simple trace</p>
      </div>
    </a>
    <a class="right-next"
       href="../04_replications/01_automated_reps.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Automating the selection of the number of replications</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">1. Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constants-and-defaults-for-modelling-as-is">2. Constants and defaults for modelling <strong>as-is</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-parameters">2.1 Distribution parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-dependent-arrival-rates-data">2.2 Time dependent arrival rates data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resource-counts">2.3 Resource counts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-model-run-settings">2.4 Simulation model run settings</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-parameterisation">3. Model parameterisation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#patient-pathways-process-logic">6. Patient Pathways Process Logic</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#main-model-class">7. Main model class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logic-to-process-end-of-run-results">8. Logic to process end of run results.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-execution">9. Model execution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#single-run-of-the-model">9.1 Single run of the model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#disabling-trace-for-multiple-independent-replications">9.2 Disabling trace for multiple independent replications</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Thomas Monks
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>