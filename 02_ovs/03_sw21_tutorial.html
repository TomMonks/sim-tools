
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>An Introduction to Optimisation via Simulation. &#8212; sim-tools docs</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '02_ovs/03_sw21_tutorial';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Change log" href="../03_CHANGES.html" />
    <link rel="prev" title="Automating the selection of the number of replications" href="../04_replications/01_automated_reps.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../00_front_page.html">
  
  
  
  
  
  
    <p class="title logo__title">sim-tools docs</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../00_front_page.html">
                    Vision for sim-tools
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Sampling</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../01_sampling/01_distributions_examples.html">Sampling using <code class="docutils literal notranslate"><span class="pre">sim_tools</span></code> classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01_sampling/02_time_dependent_examples.html">Time dependent arrivals via thinning</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Debugging</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../03_trace/01_simple_trace.html">A simple trace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_trace/01_model.html">Advanced trace</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Output Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../04_replications/01_automated_reps.html">Automating the selection of the number of replications</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Optimisation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">An Introduction to Optimisation via Simulation.</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Release History</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../03_CHANGES.html">Change log</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/TomMonks/sim-tools/main?urlpath=lab/tree/02_ovs/03_sw21_tutorial.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/TomMonks/sim-tools/blob/main/02_ovs/03_sw21_tutorial.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/TomMonks/sim-tools" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/TomMonks/sim-tools/issues/new?title=Issue%20on%20page%20%2F02_ovs/03_sw21_tutorial.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/02_ovs/03_sw21_tutorial.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>An Introduction to Optimisation via Simulation.</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">An Introduction to Optimisation via Simulation.</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-choose-the-best-setup-for-a-system">How to choose the best setup for a system.</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-tutorial-for-the-simulation-workshop-2021">A tutorial for the Simulation Workshop 2021</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-models">Simulation Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-simple-sequence-of-normal-distributions">Creating a simple sequence of normal distributions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-custom-model-with-known-designs">Creating a custom model with known designs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-model-with-randomly-sampled-designs">Creating a model with randomly sampled designs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-manual-optimisation-framework">A manual optimisation framework</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-optimisation-of-a-model-with-unknown-means">Manual Optimisation of a model with unknown means.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#indifference-zone-ranking-and-selection">Indifference Zone Ranking and Selection</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procedure-kn">Procedure <strong>KN</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-1-a-simple-sequence-of-normal-distributions">Example 1.  A simple sequence of normal distributions.</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-kn">Setting up KN</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#running-kn">Running KN</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Procedure <strong>KN++</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2-solving-the-simple-problem-using-kn">Example 2. Solving the simple problem using KN++</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-comparing-kn-and-kn-on-a-larger-design">Exercise 1. Comparing KN and KN++ on a larger design.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-a-more-difficult-optimisation-problem">Exercise 2: A more difficult optimisation problem</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#optimal-computing-budget-allocation-ocba">Optimal Computing Budget Allocation (OCBA)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-3-applying-ocba-to-the-simple-problem">Example 3. Applying OCBA to the simple problem.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-exploring-ocba-and-pcs">Exercise 3. Exploring OCBA and $PCS$</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-calculating-the-expected-opportunity-cost">Exercise 4. Calculating the Expected Opportunity Cost.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimal-computing-budget-allocation-top-m-ocba-m">Optimal Computing Budget Allocation Top M (OCBA-m)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-4-selecting-the-top-2-designs">Example 4. Selecting the top 2 designs.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-5-select-the-top-3-designs-out-of-100-designs">Exercise 5. Select the top 3 designs out of 100 designs.</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#the-end">THE END</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="an-introduction-to-optimisation-via-simulation">
<h1>An Introduction to Optimisation via Simulation.<a class="headerlink" href="#an-introduction-to-optimisation-via-simulation" title="Link to this heading">#</a></h1>
</section>
<section id="how-to-choose-the-best-setup-for-a-system">
<h1>How to choose the best setup for a system.<a class="headerlink" href="#how-to-choose-the-best-setup-for-a-system" title="Link to this heading">#</a></h1>
<section id="a-tutorial-for-the-simulation-workshop-2021">
<h2>A tutorial for the Simulation Workshop 2021<a class="headerlink" href="#a-tutorial-for-the-simulation-workshop-2021" title="Link to this heading">#</a></h2>
<p><strong>Dr Christine S.M Currie and Tom Monks</strong></p>
<p>This tutorial introduces Ranking and Selection procedures for stochastic computer simulation.  We focus on in difference zone and optimal computer budget allocation procedures. The procedures are:</p>
<ul class="simple">
<li><p>KN and KN++</p></li>
<li><p>OCBA and OCBA-m</p></li>
</ul>
<blockquote>
<div><p>The code implementing the Ranking and Selection procedures explored in this tutorial is available online with an MIT license https://github.com/TomMonks/sim-tools</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run this first to install the OvS procedures so we can use them in the tutorial.</span>
<span class="c1"># !pip install sim-tools</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sim_tools.ovs.toy_models</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">custom_gaussian_model</span><span class="p">,</span>
                                      <span class="n">gaussian_sequence_model</span><span class="p">,</span>
                                      <span class="n">random_gaussian_model</span><span class="p">,</span>
                                      <span class="n">ManualOptimiser</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="simulation-models">
<h2>Simulation Models<a class="headerlink" href="#simulation-models" title="Link to this heading">#</a></h2>
<p>To keep the focus of this tutorial on Ranking and Selection procedures and what they do, and how they perform in practice, the models we introduce are deliberately simple.   The following sections describe how to create a a set of simulation models where the outputs are independent guassian distributions.  There are three options:</p>
<ul class="simple">
<li><p>the means of these outputs distributions follow a sequence (e.g. 1, 2, 3, 4, 5) variance is 1.0.</p></li>
<li><p>the means and variances are user specified.</p></li>
<li><p>the means and variances are randomly generated.</p></li>
</ul>
<section id="creating-a-simple-sequence-of-normal-distributions">
<h3>Creating a simple sequence of normal distributions<a class="headerlink" href="#creating-a-simple-sequence-of-normal-distributions" title="Link to this heading">#</a></h3>
<p>A simple model can be created using the <code class="docutils literal notranslate"><span class="pre">guassian_sequance_model()</span></code> function.  This creates a simulation model where the output of each design follows a $N - (\mu_{i}, 1.0)$ :</p>
<p>The function accepts three keyword arguments:</p>
<ul class="simple">
<li><p><strong>start</strong> - int, the first mean in the sequence (inclusive)</p></li>
<li><p><strong>end</strong> - int, the last mean int the sequence (inclusive)</p></li>
<li><p><strong>step</strong> - int, the difference between mean i and mean i + 1.</p></li>
</ul>
<p>For example, the following code creates a simulation model with 10 designs with means 1 to 10 and unit variance.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">guassian_sequence_model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>To create a simulation model with 5 designs where $\mu_{i+1} - \mu_i = 2 $ :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">guassian_sequence_model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="creating-a-custom-model-with-known-designs">
<h3>Creating a custom model with known designs<a class="headerlink" href="#creating-a-custom-model-with-known-designs" title="Link to this heading">#</a></h3>
<p>Instead of a sequence of normal distributions with unit variance, it is possible to create a custom set of designs with varying variances. Use the <code class="docutils literal notranslate"><span class="pre">custom_guassian_model</span></code> function for this task.  For example to create a custom set of designs:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<span class="n">variances</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]</span>

<span class="n">custom_model</span> <span class="o">=</span> <span class="n">custom_guassian_model</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">variances</span><span class="p">)</span>
</pre></div>
</div>
<p>The following code demonstrates how to create a sequence of 100 designs with variances that are 10% of the mean.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n_designs</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_designs</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">variances</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span><span class="o">*</span><span class="mf">0.1</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_designs</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

<span class="n">custom_model</span> <span class="o">=</span> <span class="n">custom_guassian_model</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">variances</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="creating-a-model-with-randomly-sampled-designs">
<h3>Creating a model with randomly sampled designs<a class="headerlink" href="#creating-a-model-with-randomly-sampled-designs" title="Link to this heading">#</a></h3>
<p>To create a model with a set of unknown designs (within a specified mean and variance tolerance) use</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mean_low</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">mean_high</span> <span class="o">=</span> <span class="mf">15.0</span>
<span class="n">var_low</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">var_high</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">n_designs</span> <span class="o">=</span> <span class="mi">15</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">random_guassian_model</span><span class="p">(</span><span class="n">mean_low</span><span class="p">,</span> <span class="n">mean_high</span><span class="p">,</span> <span class="n">var_low</span><span class="p">,</span> <span class="n">var_high</span><span class="p">,</span> <span class="n">n_designs</span><span class="p">)</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><strong>mean_low</strong> - float, a lower bound on the means of the output distributions</p></li>
<li><p><strong>mean_high</strong> - float, an upper bound on the means</p></li>
<li><p><strong>var_low</strong> - float, a lower bound on the variance of the output distributions</p></li>
<li><p><strong>var_high</strong> - float, an upper bound on the variances.</p></li>
<li><p><strong>n_designs</strong> - int, the number of designs to create.</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="a-manual-optimisation-framework">
<h2>A manual optimisation framework<a class="headerlink" href="#a-manual-optimisation-framework" title="Link to this heading">#</a></h2>
<p>Before using the <strong>Optimisation via Simulation</strong> (OvS) procedures, it is recommended that you get a feel for the framework in which the OvS procedures operate.  To do this we will create some models and explore them using a <code class="docutils literal notranslate"><span class="pre">ManualOptimiser</span></code>.  This allows the user to run independent and multiple replications of the model yourself independent of any algorithm.  The <code class="docutils literal notranslate"><span class="pre">ManualOptimiser</span></code> keeps track of the means, variances and number of replications run for each design.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">ManualOptimiser</span></code> object requires two parameters when it is created.</p>
<ul class="simple">
<li><p>model - object, e.g. a model that is a sequence of normal distributions</p></li>
<li><p>n_designs - the number of designs to be considered.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">manual_opt</span> <span class="o">=</span> <span class="n">ManualOptimiser</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">gaussian_sequence_model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                             <span class="n">n_designs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We can print the optimiser object to help us remember what parameters we set.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">manual_opt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ManualOptimiser(model=BanditCasino(), n_designs=10, verbose=False)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Follow Law and Kelton’s advice and run 3 initial replications of each design.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">manual_opt</span><span class="o">.</span><span class="n">simulate_designs</span><span class="p">(</span><span class="n">replications</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The optimiser keeps track of the allocation of replications across each design.  For efficiency it doesn’t store each individual observation, but it does compute a running mean and variance.</p>
<ul class="simple">
<li><p>Let’s have a look at the replication allocation between and results of each design.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">manual_opt</span><span class="o">.</span><span class="n">allocations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3, 3, 3, 3, 3, 3, 3, 3, 3, 3], dtype=int32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># this is a hack to view at 1 decimal place.</span>
<span class="n">manual_opt</span><span class="o">.</span><span class="n">means</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.9,  2.4,  3.2,  4.8,  5.2,  6.1,  6.6,  8.3, 10.1, 10.7])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">manual_opt</span><span class="o">.</span><span class="n">vars</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.3, 0. , 0.5, 0.5, 3.8, 1.2, 0.5, 0.3, 0.1, 0.1])
</pre></div>
</div>
</div>
</div>
<p>Now let’s run 1 additional replication of the top 3 designs.
Note - in python arrays are <strong>zero indexed</strong>.  This means that design 1 has index 0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">manual_opt</span><span class="o">.</span><span class="n">simulate_designs</span><span class="p">(</span><span class="n">design_indexes</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="n">replications</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">manual_opt</span><span class="o">.</span><span class="n">allocations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3, 3, 3, 3, 3, 3, 3, 4, 4, 4], dtype=int32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">manual_opt</span><span class="o">.</span><span class="n">means</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.9,  2.4,  3.2,  4.8,  5.2,  6.1,  6.6,  8. ,  9.8, 10.4])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">manual_opt</span><span class="o">.</span><span class="n">vars</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.3, 0. , 0.5, 0.5, 3.8, 1.2, 0.5, 0.8, 0.3, 0.5])
</pre></div>
</div>
</div>
</div>
<section id="manual-optimisation-of-a-model-with-unknown-means">
<h3>Manual Optimisation of a model with unknown means.<a class="headerlink" href="#manual-optimisation-of-a-model-with-unknown-means" title="Link to this heading">#</a></h3>
<p><strong>Now have a go yourself</strong>.  This time create a model with random designs.  Run as many replications of each design as you think is neccessary to make a decision about which design is best.  Here we define best as the design with the largest mean value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#create random problem</span>
<span class="n">rnd_model</span> <span class="o">=</span> <span class="n">random_gaussian_model</span><span class="p">(</span><span class="n">mean_low</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">mean_high</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> 
                                  <span class="n">var_low</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">var_high</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
                                  <span class="n">n_designs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1">#create manual optimiser for you to use.</span>
<span class="n">manual_opt</span> <span class="o">=</span> <span class="n">ManualOptimiser</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">rnd_model</span><span class="p">,</span> <span class="n">n_designs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#insert your code here...</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<hr class="docutils" />
<section id="indifference-zone-ranking-and-selection">
<h1>Indifference Zone Ranking and Selection<a class="headerlink" href="#indifference-zone-ranking-and-selection" title="Link to this heading">#</a></h1>
<section id="procedure-kn">
<h2>Procedure <strong>KN</strong><a class="headerlink" href="#procedure-kn" title="Link to this heading">#</a></h2>
<p>The first Ranking and Selection (R&amp;S) algorithm we will explore is <strong>Procedure KN</strong> developed by Kim and Nelson. This is an <em>Indifference Zone</em> (IZ) approach to R&amp;S.  IZ procedures exploit the the idea that the performance of one or more of the sub-optimal designs are in fact so close to the best performing system that a user does not care which one is chosen (the decision maker is said to be <em>indifferent</em> to this choice).  To do this a user must specify a quantity $\delta$.  Procedure KN provides a theorectical guarantee to select the best system or a system within $\delta$ of the best with probability of $1 - \alpha$.</p>
<p>A key feature of KN is that it only estimates the variance of each design once.  This happens after an initial number of replications (specified by the user) $n_0$.</p>
<p>To run Kim and Nelson’s R&amp;S procedure KN, create an instance of <code class="docutils literal notranslate"><span class="pre">ovs.indifference_zone.KN</span></code></p>
<p>An object of type KN takes the following parameters:</p>
<ul class="simple">
<li><p><strong>model</strong> - a simulation model</p></li>
<li><p><strong>n_designs</strong> - int, the number of competing designs to compare</p></li>
<li><p><strong>delta</strong> - float, the indifference zone</p></li>
<li><p><strong>alpha</strong> - float, $PCS = 1-\alpha$ (default=0.05)</p></li>
<li><p><strong>n_0</strong> - int, $n_0$ the number of initial replications (default=2)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sim_tools.ovs.indifference_zone</span><span class="w"> </span><span class="kn">import</span> <span class="n">KN</span><span class="p">,</span> <span class="n">KNPlusPlus</span>
</pre></div>
</div>
</div>
</div>
<section id="example-1-a-simple-sequence-of-normal-distributions">
<h3>Example 1.  A simple sequence of normal distributions.<a class="headerlink" href="#example-1-a-simple-sequence-of-normal-distributions" title="Link to this heading">#</a></h3>
<p>The first problem we will test KN against is selecting the largest mean from a sequence of 10 normal distributions (means raning from 1 to 10) with unit variance.  We want a $PCS = 0.95$ and are indifferent to designs that are within an average of 1.0 of the best.</p>
<p>For this simple problem, we will follow Law’s longstanding advice of setting $n_0 = 5$ i.e 5 initial replications of each design.</p>
<section id="setting-up-kn">
<h4>Setting up KN<a class="headerlink" href="#setting-up-kn" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N_DESIGNS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">DELTA</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">ALPHA</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">N_0</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1">#first we create the simulation model. </span>
<span class="n">model</span> <span class="o">=</span> <span class="n">gaussian_sequence_model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N_DESIGNS</span><span class="p">)</span>

<span class="c1">#then we create the KN R&amp;S object and pass in our parameters.</span>
<span class="c1">#note that this doesn&#39;t run the optimisation yet.</span>
<span class="n">kn</span> <span class="o">=</span> <span class="n">KN</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> 
        <span class="n">n_designs</span><span class="o">=</span><span class="n">N_DESIGNS</span><span class="p">,</span> 
        <span class="n">delta</span><span class="o">=</span><span class="n">DELTA</span><span class="p">,</span> 
        <span class="n">alpha</span><span class="o">=</span><span class="n">ALPHA</span><span class="p">,</span> 
        <span class="n">n_0</span><span class="o">=</span><span class="n">N_0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#quickly check if KN is parameterised as expected</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KN(n_designs=10, delta=1.0, alpha=0.05, n_0=5, obj=max)
</pre></div>
</div>
</div>
</div>
</section>
<section id="running-kn">
<h4>Running KN<a class="headerlink" href="#running-kn" title="Link to this heading">#</a></h4>
<p>Now that we have created the KN object we can run the solver at any time we choose.  To do this call the <code class="docutils literal notranslate"><span class="pre">KN.solve()</span></code> method.  This method returns a design within the indifference zone $(1 - alpha$) of the time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#this runs KN (you can run this cell multiple times if you wish)</span>
<span class="n">best_design</span> <span class="o">=</span> <span class="n">kn</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

<span class="c1">#print out the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;best design</span><span class="se">\t</span><span class="si">{</span><span class="n">best_design</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;allocations</span><span class="se">\t</span><span class="si">{</span><span class="n">kn</span><span class="o">.</span><span class="n">_allocations</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;total reps</span><span class="se">\t</span><span class="si">{</span><span class="n">kn</span><span class="o">.</span><span class="n">_allocations</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>best design	[9]
allocations	[ 5  5  5  5  5  6  5 22  8 23]
total reps	89
</pre></div>
</div>
</div>
</div>
<p>In general you should see that KN simulates the top 2-3 designs the most with the lower performing designs eliminated early on (possibly after the initial stage of replication).</p>
</section>
</section>
</section>
<section id="id1">
<h2>Procedure <strong>KN++</strong><a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>Kim and Nelson’s KN++ procedure is an enhancement on KN.  KN++ introduces an <strong>update</strong> step that recalculates the variance of the differences between designs.</p>
<p>To run procedure KN++, create an instance of <code class="docutils literal notranslate"><span class="pre">ovs.indifference_zone.KNPlusPlus</span></code></p>
<section id="example-2-solving-the-simple-problem-using-kn">
<h3>Example 2. Solving the simple problem using KN++<a class="headerlink" href="#example-2-solving-the-simple-problem-using-kn" title="Link to this heading">#</a></h3>
<p>We will run KN++ on the same simulation model as KN.  In general you should see that KN++ uses less replication to find a design within the indifference zone.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knpp</span> <span class="o">=</span> <span class="n">KNPlusPlus</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> 
                  <span class="n">n_designs</span><span class="o">=</span><span class="n">N_DESIGNS</span><span class="p">,</span> 
                  <span class="n">delta</span><span class="o">=</span><span class="n">DELTA</span><span class="p">,</span> 
                  <span class="n">alpha</span><span class="o">=</span><span class="n">ALPHA</span><span class="p">,</span> 
                  <span class="n">n_0</span><span class="o">=</span><span class="n">N_0</span><span class="p">)</span>

<span class="n">best_design</span> <span class="o">=</span> <span class="n">knpp</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;best design</span><span class="se">\t</span><span class="si">{</span><span class="n">best_design</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;allocations</span><span class="se">\t</span><span class="si">{</span><span class="n">knpp</span><span class="o">.</span><span class="n">_allocations</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;total reps</span><span class="se">\t</span><span class="si">{</span><span class="n">knpp</span><span class="o">.</span><span class="n">_allocations</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>best design	[9]
allocations	[ 6  5  5  5  5  8  6  7 10 11]
total reps	68
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="exercise-1-comparing-kn-and-kn-on-a-larger-design">
<h2>Exercise 1. Comparing KN and KN++ on a larger design.<a class="headerlink" href="#exercise-1-comparing-kn-and-kn-on-a-larger-design" title="Link to this heading">#</a></h2>
<p>Your task is to compare KN and KN++ optimising a simulation model with 100 competing designs.  These designs are a sequence of 100 normal distributions with unit variance.  The objective is to find the design with the maximum mean.</p>
<p>What do you notice about the replications required from each method?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#the code to set up the simulation model has been provided below.</span>
<span class="n">N_DESIGNS</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">DELTA</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">ALPHA</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">N_0</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1">#first we create the simulation model. </span>
<span class="n">model</span> <span class="o">=</span> <span class="n">gaussian_sequence_model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N_DESIGNS</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#your code goes here...</span>
<span class="c1"># hint 1. you need to create KN and KNPlusPlus objects, pass in the simulation model and run them.  </span>
<span class="c1"># hint 2. try running the models a few times.  </span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-2-a-more-difficult-optimisation-problem">
<h2>Exercise 2: A more difficult optimisation problem<a class="headerlink" href="#exercise-2-a-more-difficult-optimisation-problem" title="Link to this heading">#</a></h2>
<p>We will now explore how the IZ procedures perform on a slightly harder optimisation problem where the mean of the designs are closer together and have differing variances.</p>
<p>The problem is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">4.3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">]</span>
<span class="n">variances</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
</pre></div>
</div>
<p>The ‘optimal’ mean design is at index 5 (4.3). It is a very noisy design.   We will set a $\delta$ so that there are multiple designs within the IZ.</p>
<p>Your task is to compare the performance of KN and KN++ given the following parameters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N_DESIGNS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">N_0</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">DELTA</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">ALPHA</span> <span class="o">=</span> <span class="mf">0.05</span>
</pre></div>
</div>
<p>We are also setting a random seed before running each procedure.  This ensures that the first stage of replications returns the same samples.</p>
<p>Questions:</p>
<ul class="simple">
<li><p>Do the methods return the ‘optimal’ design or another design within the indifference zone?</p></li>
<li><p>Which procedure require the most replication effort?  Does it vary?</p></li>
<li><p>Are there any differences in designs selected and the number of replications needed?  Try different values of <code class="docutils literal notranslate"><span class="pre">SEED</span></code>.</p></li>
<li><p>What happens if you try difference values of $n_0$ e.g. 20 and 50?</p></li>
<li><p>What happens if you change $\alpha$ to 0.1?</p></li>
</ul>
<div class="alert alert-block alert-info">
<b>RUNTIME WARNING!</b> This problem requires many more replications.  It will take a few seconds for the procedures to return a design.</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set problem parameters and create simulation model.</span>

<span class="n">N_DESIGNS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">N_0</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">DELTA</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">ALPHA</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="c1">#change the value of seed.</span>
<span class="n">SEED</span> <span class="o">=</span> <span class="mi">999</span>

<span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">4.3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">]</span>
<span class="n">variances</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>

<span class="n">guass_model</span> <span class="o">=</span> <span class="n">custom_gaussian_model</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">variances</span><span class="p">)</span>

<span class="c1">#print out which design indexes are in the indifference zone</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="mf">4.3</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">means</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">DELTA</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2 5 8 9]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create an instance of KN and solve.</span>

<span class="n">kn</span> <span class="o">=</span> <span class="n">KN</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">guass_model</span><span class="p">,</span> 
        <span class="n">n_designs</span><span class="o">=</span><span class="n">N_DESIGNS</span><span class="p">,</span> 
        <span class="n">delta</span><span class="o">=</span><span class="n">DELTA</span><span class="p">,</span> 
        <span class="n">alpha</span><span class="o">=</span><span class="n">ALPHA</span><span class="p">,</span> 
        <span class="n">n_0</span><span class="o">=</span><span class="n">N_0</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">best_design</span> <span class="o">=</span> <span class="n">kn</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

<span class="c1">#print out the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;best design</span><span class="se">\t</span><span class="si">{</span><span class="n">best_design</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;allocations</span><span class="se">\t</span><span class="si">{</span><span class="n">kn</span><span class="o">.</span><span class="n">_allocations</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;total reps</span><span class="se">\t</span><span class="si">{</span><span class="n">kn</span><span class="o">.</span><span class="n">_allocations</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>best design	[2]
allocations	[  415   314 41678    20    20    29  6697 41677 23238    20]
total reps	114108
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use KN++ on the same problem</span>
<span class="n">knpp</span> <span class="o">=</span> <span class="n">KNPlusPlus</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">guass_model</span><span class="p">,</span> 
                  <span class="n">n_designs</span><span class="o">=</span><span class="n">N_DESIGNS</span><span class="p">,</span> 
                  <span class="n">delta</span><span class="o">=</span><span class="n">DELTA</span><span class="p">,</span> 
                  <span class="n">alpha</span><span class="o">=</span><span class="n">ALPHA</span><span class="p">,</span> 
                  <span class="n">n_0</span><span class="o">=</span><span class="n">N_0</span><span class="p">)</span>

<span class="c1"># we use the same random seed to help with comparison.</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">best_design</span> <span class="o">=</span> <span class="n">knpp</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

<span class="c1"># print out the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;best design</span><span class="se">\t</span><span class="si">{</span><span class="n">best_design</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;allocations</span><span class="se">\t</span><span class="si">{</span><span class="n">knpp</span><span class="o">.</span><span class="n">_allocations</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;total reps</span><span class="se">\t</span><span class="si">{</span><span class="n">knpp</span><span class="o">.</span><span class="n">_allocations</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>best design	[5]
allocations	[  190   200   107    20    20 28167  8476  7204 28166 15383]
total reps	87933
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="optimal-computing-budget-allocation-ocba">
<h1>Optimal Computing Budget Allocation (OCBA)<a class="headerlink" href="#optimal-computing-budget-allocation-ocba" title="Link to this heading">#</a></h1>
<p>We will first consider the scenario where the objective is find the optimal design.  The distinguishing feature of OCBA procedures from IZ procedures a fixed budget formulation of the optimisation problem.  I.e. achieve the best $PCS$ with the budget available.</p>
<p>Single solution OCBA object can be created by importing <code class="docutils literal notranslate"><span class="pre">ovs.fixed_budget.OCBA</span></code></p>
<p>An object of type <code class="docutils literal notranslate"><span class="pre">OCBA</span></code> takes the following parameters:</p>
<ul class="simple">
<li><p><strong>model</strong> - a simulation model</p></li>
<li><p><strong>n_designs</strong> - int, the number of competing designs to compare</p></li>
<li><p><strong>budget</strong> - int, the total number of replications to allocate across designs</p></li>
<li><p><strong>delta</strong> - int, the incremental amount of replications to allocate at each round</p></li>
<li><p><strong>n_0</strong> - int, $n_0$ the number of initial replications (default=5)</p></li>
<li><p><strong>obj</strong> - str, ‘min’ if minimisation; ‘max’ if maximisation (default=’min’)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sim_tools.ovs.fixed_budget</span><span class="w"> </span><span class="kn">import</span> <span class="n">OCBA</span><span class="p">,</span> <span class="n">OCBAM</span>
</pre></div>
</div>
</div>
</div>
<section id="example-3-applying-ocba-to-the-simple-problem">
<h2>Example 3. Applying OCBA to the simple problem.<a class="headerlink" href="#example-3-applying-ocba-to-the-simple-problem" title="Link to this heading">#</a></h2>
<p>We will first apply OCBA to the simple sequence of normal random variables that we used in Example 1.</p>
<p>Initially we will set a simulation budget of 1000 replications. This is overkill, but makes it easier to see what OCBA is doing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N_DESIGNS</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1">#remember that delta is not the same as in IZ!</span>
<span class="c1">#it is the amount of replication to allocate at each stage.</span>
<span class="n">DELTA</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1">#the intial stage will run 5 reps of each design. </span>
<span class="n">N_0</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">BUDGET</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1">#first we create the simulation model. </span>
<span class="n">model</span> <span class="o">=</span> <span class="n">gaussian_sequence_model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N_DESIGNS</span><span class="p">)</span>

<span class="n">ocba</span> <span class="o">=</span> <span class="n">OCBA</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> 
            <span class="n">n_designs</span><span class="o">=</span><span class="n">N_DESIGNS</span><span class="p">,</span> 
            <span class="n">budget</span><span class="o">=</span><span class="n">BUDGET</span><span class="p">,</span> 
            <span class="n">delta</span><span class="o">=</span><span class="n">DELTA</span><span class="p">,</span> 
            <span class="n">n_0</span><span class="o">=</span><span class="n">N_0</span><span class="p">,</span> 
            <span class="n">obj</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ocba</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OCBA(n_designs=10, budget=1000, delta=5, n_0=5, obj=max)
</pre></div>
</div>
</div>
</div>
<p>call the <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method to run the optimisation.  If needed, run OCBA a few times.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_design</span> <span class="o">=</span> <span class="n">ocba</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

<span class="c1">#print out the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;best design</span><span class="se">\t</span><span class="si">{</span><span class="n">best_design</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;allocations</span><span class="se">\t</span><span class="si">{</span><span class="n">ocba</span><span class="o">.</span><span class="n">_allocations</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;total reps</span><span class="se">\t</span><span class="si">{</span><span class="n">ocba</span><span class="o">.</span><span class="n">_allocations</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>best design	9
allocations	[  5  11   5   5  15   5   5 101 426 422]
total reps	1000
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Run the cell above a few times.  You should see that OCBA is allocating most of the budget across the top 3 designs.</p></li>
</ul>
</section>
<section id="exercise-3-exploring-ocba-and-pcs">
<h2>Exercise 3. Exploring OCBA and $PCS$<a class="headerlink" href="#exercise-3-exploring-ocba-and-pcs" title="Link to this heading">#</a></h2>
<p>OCBA conceptualises optimisation as a fixed budget problem.  Let’s run an experiment where we estimate what $PCS$ is actually being achieved under a given budget.  KN++ was reporting a range of 70-80 replications.  Let’s try 75.</p>
<p>To help with this test you can import an Experiment object: <code class="docutils literal notranslate"><span class="pre">ovs.evaluation.Experiment</span></code></p>
<p>An <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> object takes the following parameters:</p>
<ul class="simple">
<li><p><strong>env</strong> - the simulated environment aka the model.</p></li>
<li><p><strong>procedure</strong> - the method to test e.g. KNPlusPlus or OCBA</p></li>
<li><p><strong>best_index</strong> - the index of the best design in the simulation model (zero based).</p></li>
<li><p><strong>objective</strong> - ‘max’ or ‘min’</p></li>
<li><p><strong>replications</strong> - the number of repeats of the experiment to run.</p></li>
</ul>
<p><strong>Your task is to run the experiment with different budgets.  E.g. 60, 70 and 75.  Remember that you cannot go lower than N_0 + DELTA</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sim_tools.ovs.evaluation</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-block alert-info">
<b>RUNTIME WARNING!</b> The experiment will will take a few seconds to complete. </div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#this is the budget you can vary.</span>
<span class="n">BUDGET</span> <span class="o">=</span> <span class="mi">75</span>

<span class="c1">#you could also vary delta.  What happens if delta = 1?</span>
<span class="n">DELTA</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">N_DESIGNS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">N_0</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">ocba</span> <span class="o">=</span> <span class="n">OCBA</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> 
            <span class="n">n_designs</span><span class="o">=</span><span class="n">N_DESIGNS</span><span class="p">,</span> 
            <span class="n">budget</span><span class="o">=</span><span class="n">BUDGET</span><span class="p">,</span> 
            <span class="n">delta</span><span class="o">=</span><span class="n">DELTA</span><span class="p">,</span> 
            <span class="n">n_0</span><span class="o">=</span><span class="n">N_0</span><span class="p">,</span> 
            <span class="n">obj</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>

<span class="c1">#create an experiment and repeat 1000 times.</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">procedure</span><span class="o">=</span><span class="n">ocba</span><span class="p">,</span> <span class="n">best_index</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> 
                 <span class="n">replications</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="c1">#print the probability of correct selection achieved.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PCS=</span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">p_correct_selections</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PCS=0.999
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-4-calculating-the-expected-opportunity-cost">
<h2>Exercise 4. Calculating the Expected Opportunity Cost.<a class="headerlink" href="#exercise-4-calculating-the-expected-opportunity-cost" title="Link to this heading">#</a></h2>
<p>Another way to evaluate a procedures performance is to calculate the Expected Opportunity Cost.  This is the average difference between the best mean and the selected mean in each repeat of the experiment.</p>
<p><strong>Task: try varying the budget, delta and n_0.  What is the effect?</strong></p>
<p>We will only run a small number of repeats of the experiments to save runtime!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># KN++ needed a large budget to reach its desired precision.  </span>
<span class="c1"># We will try a smaller budgets here</span>
<span class="n">BUDGET</span> <span class="o">=</span> <span class="mi">20000</span>
<span class="n">DELTA</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">N_DESIGNS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">N_0</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">4.3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">]</span>
<span class="n">variances</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>

<span class="n">guass_model</span> <span class="o">=</span> <span class="n">custom_gaussian_model</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">variances</span><span class="p">)</span>

<span class="n">ocba</span> <span class="o">=</span> <span class="n">OCBA</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">guass_model</span><span class="p">,</span> 
            <span class="n">n_designs</span><span class="o">=</span><span class="n">N_DESIGNS</span><span class="p">,</span> 
            <span class="n">budget</span><span class="o">=</span><span class="n">BUDGET</span><span class="p">,</span> 
            <span class="n">delta</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
            <span class="n">n_0</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> 
            <span class="n">obj</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>

<span class="c1"># create an experiment and repeat 10 times (in practice we would use more!)</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">guass_model</span><span class="p">,</span> <span class="n">procedure</span><span class="o">=</span><span class="n">ocba</span><span class="p">,</span> <span class="n">best_index</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> 
                 <span class="n">replications</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="c1"># the probability of correct selection achieved.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PCS=</span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">p_correct_selections</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># IF YOU REMEMBER FROM Example 2 THE DESIGNS IN THE IZ WERE [2 5 8 9]</span>
<span class="c1"># Let&#39;s print out the selections made...</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;selected designs: </span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">selections</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># the average of the best_mean - selected_design_mean for each rep of the exp.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;EOC=</span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">expected_opportunity_cost</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PCS=0.7
selected designs: [5 5 5 8 5 5 5 9 2 5]
EOC=0.029999999999999895
</pre></div>
</div>
</div>
</div>
</section>
<section id="optimal-computing-budget-allocation-top-m-ocba-m">
<h2>Optimal Computing Budget Allocation Top M (OCBA-m)<a class="headerlink" href="#optimal-computing-budget-allocation-top-m-ocba-m" title="Link to this heading">#</a></h2>
<p>In many situations it is not possible or desirable to model all of the detail in a simulation model.   A procedure that offers a top performing group of designs is more useful in these circumstances.  It allows a decision maker to choose between good designs while taking other factors into account.</p>
<p>So far we have only considered selecting the best system.  OCBA-m extended OCBA to identify the <strong>top m designs</strong>.</p>
<p>A top-m solution OCBA object can be created by importing <code class="docutils literal notranslate"><span class="pre">ovs.fixed_budget.OCBAM</span></code></p>
<p>An object of type <code class="docutils literal notranslate"><span class="pre">OCBAM</span></code> takes the following parameters:</p>
<ul class="simple">
<li><p><strong>model</strong> - a simulation model</p></li>
<li><p><strong>n_designs</strong> - int, the number of competing designs to compare</p></li>
<li><p><strong>budget</strong> - int, the total number of replications to allocate across designs</p></li>
<li><p><strong>delta</strong> - int, the incremental amount of replications to allocate at each round</p></li>
<li><p><strong>n_0</strong> - int, $n_0$ the number of initial replications (default=5)</p></li>
<li><p><strong>m</strong> - int, $m$ the number of top designs to return.  m must be &gt;=2.  For m = 1 see OCBA.</p></li>
<li><p><strong>obj</strong> - str, ‘min’ if minimisation; ‘max’ if maximisation (default=’min’)</p></li>
</ul>
</section>
<section id="example-4-selecting-the-top-2-designs">
<h2>Example 4. Selecting the top 2 designs.<a class="headerlink" href="#example-4-selecting-the-top-2-designs" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N_DESIGNS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">BUDGET</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">DELTA</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">N_0</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1">#you can vary this parameter to change the number selected.</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">guass_model</span> <span class="o">=</span> <span class="n">gaussian_sequence_model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N_DESIGNS</span><span class="p">)</span>

<span class="n">ocbam</span> <span class="o">=</span> <span class="n">OCBAM</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">guass_model</span><span class="p">,</span> 
              <span class="n">n_designs</span><span class="o">=</span><span class="n">N_DESIGNS</span><span class="p">,</span> 
              <span class="n">budget</span><span class="o">=</span><span class="n">BUDGET</span><span class="p">,</span> 
              <span class="n">delta</span><span class="o">=</span><span class="n">DELTA</span><span class="p">,</span> 
              <span class="n">n_0</span><span class="o">=</span><span class="n">N_0</span><span class="p">,</span> 
              <span class="n">m</span><span class="o">=</span><span class="n">M</span><span class="p">,</span>
              <span class="n">obj</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ocbam</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OCBA(n_designs=10, m=3, budget=1000, delta=5, n_0=5, obj=max)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#print out the results</span>
<span class="n">best_designs</span> <span class="o">=</span> <span class="n">ocbam</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;best designs</span><span class="se">\t</span><span class="si">{</span><span class="n">best_designs</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;allocations</span><span class="se">\t</span><span class="si">{</span><span class="n">ocbam</span><span class="o">.</span><span class="n">_allocations</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;total reps</span><span class="se">\t</span><span class="si">{</span><span class="n">ocbam</span><span class="o">.</span><span class="n">_allocations</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>best designs	[7 8 9]
allocations	[ 20  23  21  38  39  75  79 303 302 100]
total reps	1000
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-5-select-the-top-3-designs-out-of-100-designs">
<h2>Exercise 5. Select the top 3 designs out of 100 designs.<a class="headerlink" href="#exercise-5-select-the-top-3-designs-out-of-100-designs" title="Link to this heading">#</a></h2>
<p>Task: Use OCBA-m to select the <strong>smallest</strong> 3 designs from the example problem.  What impact does varying the budget, delta and $n_0$ have on performance?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N_DESIGNS</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">BUDGET</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">DELTA</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">N_0</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1">#you can vary this parameter to change the number selected.</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">guass_model</span> <span class="o">=</span> <span class="n">gaussian_sequence_model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N_DESIGNS</span><span class="p">)</span>


<span class="c1">#insert your code here</span>
<span class="c1">#ocbam = ?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#print out the results</span>
<span class="n">best_designs</span> <span class="o">=</span> <span class="n">ocbam</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;best designs</span><span class="se">\t</span><span class="si">{</span><span class="n">best_designs</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;allocations</span><span class="se">\t</span><span class="si">{</span><span class="n">ocbam</span><span class="o">.</span><span class="n">_allocations</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;total reps</span><span class="se">\t</span><span class="si">{</span><span class="n">ocbam</span><span class="o">.</span><span class="n">_allocations</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>best designs	[7 8 9]
allocations	[ 20  23  21  38  39  75  79 303 302 100]
total reps	1000
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="the-end">
<h1>THE END<a class="headerlink" href="#the-end" title="Link to this heading">#</a></h1>
<p>What did you think of the procedures?</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "TomMonks/sim-tools",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./02_ovs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../04_replications/01_automated_reps.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Automating the selection of the number of replications</p>
      </div>
    </a>
    <a class="right-next"
       href="../03_CHANGES.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Change log</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">An Introduction to Optimisation via Simulation.</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-choose-the-best-setup-for-a-system">How to choose the best setup for a system.</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-tutorial-for-the-simulation-workshop-2021">A tutorial for the Simulation Workshop 2021</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-models">Simulation Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-simple-sequence-of-normal-distributions">Creating a simple sequence of normal distributions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-custom-model-with-known-designs">Creating a custom model with known designs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-model-with-randomly-sampled-designs">Creating a model with randomly sampled designs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-manual-optimisation-framework">A manual optimisation framework</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-optimisation-of-a-model-with-unknown-means">Manual Optimisation of a model with unknown means.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#indifference-zone-ranking-and-selection">Indifference Zone Ranking and Selection</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procedure-kn">Procedure <strong>KN</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-1-a-simple-sequence-of-normal-distributions">Example 1.  A simple sequence of normal distributions.</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-kn">Setting up KN</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#running-kn">Running KN</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Procedure <strong>KN++</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2-solving-the-simple-problem-using-kn">Example 2. Solving the simple problem using KN++</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-comparing-kn-and-kn-on-a-larger-design">Exercise 1. Comparing KN and KN++ on a larger design.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-a-more-difficult-optimisation-problem">Exercise 2: A more difficult optimisation problem</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#optimal-computing-budget-allocation-ocba">Optimal Computing Budget Allocation (OCBA)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-3-applying-ocba-to-the-simple-problem">Example 3. Applying OCBA to the simple problem.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-exploring-ocba-and-pcs">Exercise 3. Exploring OCBA and $PCS$</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-calculating-the-expected-opportunity-cost">Exercise 4. Calculating the Expected Opportunity Cost.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimal-computing-budget-allocation-top-m-ocba-m">Optimal Computing Budget Allocation Top M (OCBA-m)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-4-selecting-the-top-2-designs">Example 4. Selecting the top 2 designs.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-5-select-the-top-3-designs-out-of-100-designs">Exercise 5. Select the top 3 designs out of 100 designs.</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#the-end">THE END</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Thomas Monks
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>